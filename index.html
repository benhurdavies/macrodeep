<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Macro Shift: Deep Research Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Marked for Markdown rendering in chat -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
       .chart-container { position: relative; height: 300px; width: 100%; }
       .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
       .metric-card { transition: all 0.3s ease; }
       .metric-card:hover { transform: translateY(-2px); border-color: #d97706; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
       .ticker-badge { font-family: monospace; background: #e7e5e4; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; color: #444; }
       
       /* Power Bloc Visuals */
       .power-bar { transition: width 1s ease-in-out; }

       /* Chat Widget Animations */
       .chat-slide-in { animation: slideIn 0.3s ease-out forwards; }
       .chat-slide-out { animation: slideOut 0.3s ease-in forwards; }
       @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
       @keyframes slideOut { from { transform: translateY(0); opacity: 1; } to { transform: translateY(20px); opacity: 0; } }
       
       /* Markdown Styles in Chat */
       .prose p { margin-bottom: 0.5em; }
       .prose ul { list-style-type: disc; margin-left: 1.5em; }
       .prose strong { color: #d97706; font-weight: 700; }

       /* Impact Chain Tabs */
       .chain-tab.active { background-color: #d97706; color: white; border-color: #d97706; }
    </style>
</head>
<body class="bg-stone-100 text-stone-800 font-sans">

    <!-- NAVIGATION -->
    <nav class="sticky top-0 z-50 bg-stone-900 text-stone-100 border-b border-stone-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-2">
                    <span class="text-2xl font-bold tracking-tighter">MACRO<span class="text-amber-500">DEEP</span></span>
                </div>
                <div class="hidden md:flex space-x-6 text-sm font-medium">
                    <a href="#cycle" class="hover:text-amber-500 transition">The Big Cycle</a>
                    <a href="#impact-chains" class="hover:text-amber-500 transition">Impact Chains</a>
                    <a href="#future-powers" class="hover:text-amber-500 transition">Future Powers</a>
                    <a href="#risks" class="hover:text-amber-500 transition">Uncertainties</a>
                    <a href="#allocation" class="bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 rounded transition">Action Plan</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-20">

        <!-- SECTION 1: THE BIG CYCLE (DASHBOARD) -->
        <section id="cycle" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 bg-white p-6 rounded-lg shadow-sm border-l-4 border-amber-500">
                <h2 class="text-xl font-bold mb-4 text-stone-900">Current Cycle Position</h2>
                <div class="relative pt-1">
                    <div class="flex mb-2 items-center justify-between">
                        <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-stone-600 bg-stone-200">
                            Late Stage (Decline)
                        </span>
                        <div class="text-right">
                            <span class="text-xs font-semibold inline-block text-amber-600">
                                Critical Zone
                            </span>
                        </div>
                    </div>
                    <div class="overflow-hidden h-4 mb-4 text-xs flex rounded bg-stone-200">
                        <div style="width: 85%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-gradient-to-r from-stone-400 via-amber-500 to-red-600"></div>
                    </div>
                    <div class="flex justify-between text-xs text-stone-500 font-mono">
                        <span>Rise</span>
                        <span>Top</span>
                        <span>Decline</span>
                    </div>
                </div>
                <ul class="mt-6 space-y-3 text-sm text-stone-600">
                    <li class="flex items-start"><span class="mr-2 text-red-500">‚úñ</span> <strong>Internal Disorder:</strong> High polarization & wealth gap.</li>
                    <li class="flex items-start"><span class="mr-2 text-red-500">‚úñ</span> <strong>Debt Burden:</strong> Interest payments > Defense spending.</li>
                    <li class="flex items-start"><span class="mr-2 text-red-500">‚úñ</span> <strong>External Rival:</strong> Rise of BRICS+ & Multipolarity.</li>
                </ul>
            </div>
            
            <div class="lg:col-span-2 bg-stone-900 text-stone-100 p-8 rounded-lg shadow-xl relative overflow-hidden">
                <div class="relative z-10">
                    <h1 class="text-3xl md:text-4xl font-bold mb-4">The Great Rotation (2026‚Äì2035)</h1>
                    <p class="text-lg text-stone-400 mb-6 max-w-2xl">
                        The "150-Year Cycle Shift" is not just a theory; it is visible in the data. We are transitioning from an era of <strong>Financial Engineering</strong> (Stocks/Bonds) to an era of <strong>Physical Scarcity</strong> (Commodities/Hard Assets).
                    </p>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                        
                        <!-- Metric 1: US Debt -->
                        <div class="relative group p-3 bg-stone-800 rounded border border-stone-700 hover:border-stone-500 transition-colors">
                            <div class="text-xs text-stone-500 uppercase truncate cursor-help">US Debt</div>
                            <div class="text-xl font-mono text-red-400 truncate cursor-help">$38.4T+</div>
                            <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 hidden group-hover:block z-50 p-3 bg-black text-stone-100 text-xs rounded shadow-xl border border-stone-700 pointer-events-none">
                                <div class="font-bold text-amber-500 mb-1">US National Debt</div>
                                <div>Currently exceeding $38.4 Trillion. Interest payments are now the largest budget item.</div>
                                <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-black"></div>
                            </div>
                        </div>

                        <!-- Metric 2: Gold -->
                        <div class="relative group p-3 bg-stone-800 rounded border border-stone-700 hover:border-stone-500 transition-colors">
                            <div class="text-xs text-stone-500 uppercase truncate cursor-help">Gold Buying</div>
                            <div class="text-xl font-mono text-amber-400 truncate cursor-help">Record Highs</div>
                            <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 hidden group-hover:block z-50 p-3 bg-black text-stone-100 text-xs rounded shadow-xl border border-stone-700 pointer-events-none">
                                <div class="font-bold text-amber-500 mb-1">Central Bank Demand</div>
                                <div>Global central banks are buying gold at the fastest pace since 1967 to diversify away from USD.</div>
                                <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-black"></div>
                            </div>
                        </div>

                        <!-- Metric 3: Petrodollar -->
                        <div class="relative group p-3 bg-stone-800 rounded border border-stone-700 hover:border-stone-500 transition-colors">
                            <div class="text-xs text-stone-500 uppercase truncate cursor-help">Petrodollar</div>
                            <div class="text-xl font-mono text-stone-400 truncate cursor-help">Diluting</div>
                            <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 hidden group-hover:block z-50 p-3 bg-black text-stone-100 text-xs rounded shadow-xl border border-stone-700 pointer-events-none">
                                <div class="font-bold text-amber-500 mb-1">Reserve Status</div>
                                <div>Oil trade is increasingly settling in non-USD currencies (Yuan, Gold-notes), reducing structural demand for Dollars.</div>
                                <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-black"></div>
                            </div>
                        </div>

                        <!-- Metric 4: Buffett Indicator -->
                        <div class="relative group p-3 bg-stone-800 rounded border border-stone-700 hover:border-stone-500 transition-colors">
                            <div class="text-xs text-stone-500 uppercase truncate cursor-help">Buffett Indicator</div>
                            <div class="text-lg font-mono text-red-400 truncate cursor-help">215% (High)</div>
                            <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 hidden group-hover:block z-50 p-3 bg-black text-stone-100 text-xs rounded shadow-xl border border-stone-700 pointer-events-none">
                                <div class="font-bold text-amber-500 mb-1">Market Cap to GDP</div>
                                <div>At 215%, the stock market is significantly overvalued compared to the real economy. Historical average is ~100%.</div>
                                <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-black"></div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="absolute right-0 top-0 h-full w-1/3 bg-gradient-to-l from-amber-900/20 to-transparent pointer-events-none"></div>
            </div>
        </section>

        <!-- SECTION 2: IMPACT CHAIN EXPLORER -->
        <section id="impact-chains" class="scroll-mt-24">
            <div class="mb-8 border-b border-stone-300 pb-4">
                <h2 class="text-2xl font-bold text-stone-800">Global Impact Chain Explorer</h2>
                <p class="text-stone-600 mt-2">
                    Macro themes don't exist in isolation. Trace the "Chain of Influence" to see how specific narratives cascade into sectors, commodities, and markets.
                </p>
            </div>

            <!-- Tab Navigation -->
            <div class="flex flex-wrap gap-2 mb-6" id="chainTabs">
                <button onclick="renderChain('dedollar')" class="chain-tab active px-4 py-2 rounded-full border border-amber-600 bg-amber-600 text-white text-sm font-bold transition-all hover:shadow-md hover:scale-105">
                    üí∏ De-Dollarization
                </button>
                <button onclick="renderChain('ai_energy')" class="chain-tab px-4 py-2 rounded-full border border-stone-300 bg-white text-stone-600 text-sm font-medium hover:border-amber-500 hover:text-amber-600 transition-all hover:shadow-md hover:scale-105">
                    ‚ö° AI & Energy Crunch
                </button>
                <button onclick="renderChain('war_eco')" class="chain-tab px-4 py-2 rounded-full border border-stone-300 bg-white text-stone-600 text-sm font-medium hover:border-amber-500 hover:text-amber-600 transition-all hover:shadow-md hover:scale-105">
                    üõ°Ô∏è The War Economy
                </button>
                <button onclick="renderChain('hard_money')" class="chain-tab px-4 py-2 rounded-full border border-stone-300 bg-white text-stone-600 text-sm font-medium hover:border-amber-500 hover:text-amber-600 transition-all hover:shadow-md hover:scale-105">
                    ü•á Sound Money Return
                </button>
            </div>

            <!-- Visualization Container -->
            <div class="bg-stone-50 rounded-xl border border-stone-200 p-6 md:p-8 shadow-inner relative overflow-hidden min-h-[400px]">
                
                <!-- Dynamic Content Area -->
                <div id="chainContent" class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8 items-stretch relative z-10 transition-opacity duration-300">
                    <!-- Column 1: The Theme & Triggers -->
                    <div class="flex flex-col">
                        <div class="text-xs font-bold text-stone-400 uppercase mb-2 tracking-wider">The Macro Theme</div>
                        <div class="bg-white p-5 rounded-lg border-l-4 border-amber-500 shadow-sm h-full flex flex-col">
                            <div class="mb-4">
                                <h3 id="chain-title" class="text-xl font-bold text-stone-900 mb-2">Petrodollar Dilution</h3>
                                <p id="chain-desc" class="text-sm text-stone-600">Oil trade shifting from USD exclusivity to a multi-currency basket (Yuan, Gold, Local), reducing structural global demand for Dollars.</p>
                            </div>
                            <!-- Timeline & Triggers -->
                            <div class="mt-auto pt-4 border-t border-stone-100">
                                <div class="flex items-center justify-between text-xs mb-3">
                                    <span class="font-bold text-stone-500 uppercase">Projected Window</span>
                                    <span id="chain-timerange" class="font-mono bg-stone-100 px-2 py-1 rounded text-stone-700 font-bold border border-stone-200">2026-2030</span>
                                </div>
                                <div class="text-xs">
                                    <span class="font-bold text-stone-500 uppercase block mb-1">Probable Triggers</span>
                                    <ul id="chain-triggers" class="list-disc list-inside text-stone-600 space-y-1">
                                        <li>Saudi Arabia accepts Yuan for Oil</li>
                                        <li>BRICS Pay system launch</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="h-8 md:hidden flex justify-center items-center text-stone-300 text-2xl">‚¨á</div>
                    </div>

                    <!-- Arrow for Desktop -->
                    <div class="hidden md:flex absolute left-1/3 top-1/2 -translate-y-1/2 -translate-x-1/2 text-stone-300 text-4xl z-0">‚ûî</div>

                    <!-- Column 2: Direct Impacts -->
                    <div class="flex flex-col">
                        <div class="text-xs font-bold text-stone-400 uppercase mb-2 tracking-wider">Sector & Commodity Impact</div>
                        <div class="bg-white p-5 rounded-lg border-t-4 border-blue-500 shadow-sm h-full space-y-4">
                            <div>
                                <h4 class="font-bold text-stone-800 text-sm mb-2">Critical Commodities</h4>
                                <div id="chain-commodities" class="flex flex-wrap gap-2">
                                    <span class="px-2 py-1 bg-stone-100 text-stone-700 text-xs rounded border border-stone-200 font-mono">Gold</span>
                                    <span class="px-2 py-1 bg-stone-100 text-stone-700 text-xs rounded border border-stone-200 font-mono">Oil</span>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-bold text-stone-800 text-sm mb-2">Affected Sectors</h4>
                                <ul id="chain-sectors" class="text-sm text-stone-600 list-disc list-inside">
                                    <li>Global Banking (SWIFT)</li>
                                    <li>Emerging Market Debt</li>
                                </ul>
                            </div>
                        </div>
                        <div class="h-8 md:hidden flex justify-center items-center text-stone-300 text-2xl">‚¨á</div>
                    </div>

                    <!-- Arrow for Desktop -->
                    <div class="hidden md:flex absolute left-2/3 top-1/2 -translate-y-1/2 -translate-x-1/2 text-stone-300 text-4xl z-0">‚ûî</div>

                    <!-- Column 3: Winners & Losers -->
                    <div class="flex flex-col">
                        <div class="text-xs font-bold text-stone-400 uppercase mb-2 tracking-wider">Country & Market Effect</div>
                        <div class="bg-white p-5 rounded-lg border-r-4 border-emerald-500 shadow-sm h-full flex flex-col justify-between">
                            <div class="mb-4">
                                <h4 class="font-bold text-emerald-700 text-sm mb-1">Beneficiaries (Long)</h4>
                                <div id="chain-winners" class="text-sm text-stone-600">
                                    BRICS Nations, Gold Holders, Hard Asset Exporters
                                </div>
                            </div>
                            <div class="border-t border-stone-100 pt-4">
                                <h4 class="font-bold text-red-700 text-sm mb-1">At Risk (Short)</h4>
                                <div id="chain-losers" class="text-sm text-stone-600">
                                    US Treasury Market, Import-Dependent Nations holding USD
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gemini AI Deep Dive Button -->
                <div class="mt-6 pt-6 border-t border-stone-200 flex justify-end relative z-20">
                    <button onclick="analyzeChain()" class="flex items-center gap-2 text-sm font-medium text-indigo-600 hover:text-indigo-800 transition-colors">
                        <span class="text-lg">‚ú®</span>
                        Ask AI to analyze this specific chain
                    </button>
                </div>
            </div>
        </section>

        <!-- SECTION 3: FISCAL & ENERGY -->
        <section id="fiscal-energy" class="space-y-12">
            <!-- Fiscal Chart -->
            <div>
                <div class="flex flex-col md:flex-row justify-between items-end mb-6 border-b border-stone-300 pb-2">
                    <div>
                        <h2 class="text-2xl font-bold text-stone-800">The Fiscal Trap</h2>
                        <p class="text-stone-600 mt-1">The crossover event: Interest service now exceeds defense spending.</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-stone-200">
                        <h3 class="text-sm font-bold text-stone-500 uppercase mb-4">Fiscal Dominance Crossover</h3>
                        <div class="chart-container">
                            <canvas id="fiscalChart"></canvas>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <details class="group bg-white rounded-lg border border-stone-200 open">
                            <summary class="flex justify-between items-center font-medium cursor-pointer list-none p-4 bg-stone-50 hover:bg-stone-100 transition">
                                <span>The Mathematical Wall</span>
                                <span class="transition group-open:rotate-180">‚ñº</span>
                            </summary>
                            <div class="text-stone-600 p-4 border-t border-stone-200 text-sm">
                                At 120%+ Debt-to-GDP, the US cannot afford positive real interest rates. The Fed is forced to choose between <strong>Default</strong> (unthinkable) or <strong>Inflation</strong> (inevitable). They will choose inflation to "melt away" the real value of the debt.
                            </div>
                        </details>
                        <!-- Energy Box -->
                        <div class="bg-stone-800 p-4 rounded-lg text-stone-200 text-sm border border-stone-700">
                            <h4 class="font-bold text-amber-500 mb-2">‚ö° The Energy Nexus</h4>
                            <p>AI Data Centers require massive baseload power. This creates a structural deficit in Uranium and Copper. The grid needs a complete overhaul, adding inflationary pressure.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: FUTURE POWERS -->
        <section id="future-powers">
            <div class="mb-8 border-b border-stone-300 pb-4">
                <h2 class="text-2xl font-bold text-stone-800">Post-Pax Americana: Who Rises Next?</h2>
                <p class="text-stone-600 mt-2">
                    History abhors a vacuum. As the US moves from "Unipolar Hegemon" to one of several great powers, capital will flow to these emerging blocs.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Power 1: The Dragon (China) -->
                <div class="bg-white p-6 rounded-lg border-t-4 border-red-700 shadow-sm hover:shadow-md transition">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-lg text-stone-900">The Industrial Giant</h3>
                        <span class="text-2xl">üá®üá≥</span>
                    </div>
                    <p class="text-sm text-stone-600 mb-4"><strong>Focus:</strong> China & The Belt and Road.</p>
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between"><span>Manufacturing</span><span class="text-green-600 font-bold">Dominant</span></div>
                        <div class="flex justify-between"><span>Demographics</span><span class="text-red-600 font-bold">Collapsing</span></div>
                        <div class="flex justify-between"><span>Resources</span><span class="text-amber-600 font-bold">Dependent</span></div>
                    </div>
                </div>

                <!-- Power 2: The Elephant (India) -->
                <div class="bg-white p-6 rounded-lg border-t-4 border-orange-500 shadow-sm hover:shadow-md transition">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-lg text-stone-900">The Rising Demographics</h3>
                        <span class="text-2xl">üáÆüá≥</span>
                    </div>
                    <p class="text-sm text-stone-600 mb-4"><strong>Focus:</strong> India & The Global South.</p>
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between"><span>Manufacturing</span><span class="text-amber-600 font-bold">Rising</span></div>
                        <div class="flex justify-between"><span>Demographics</span><span class="text-green-600 font-bold">Booming</span></div>
                    </div>
                </div>

                <!-- Power 3: The Resource Bloc -->
                <div class="bg-white p-6 rounded-lg border-t-4 border-emerald-600 shadow-sm hover:shadow-md transition">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-lg text-stone-900">The Commodity Kings</h3>
                        <span class="text-2xl">üõ¢Ô∏è</span>
                    </div>
                    <p class="text-sm text-stone-600 mb-4"><strong>Focus:</strong> BRICS+ (Russia, Brazil, Saudi).</p>
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between"><span>Energy</span><span class="text-green-600 font-bold">Excess</span></div>
                        <div class="flex justify-between"><span>Food</span><span class="text-green-600 font-bold">Excess</span></div>
                    </div>
                </div>

                <!-- Power 4: The Digital State -->
                <div class="bg-white p-6 rounded-lg border-t-4 border-indigo-600 shadow-sm hover:shadow-md transition">
                    <div class="flex justify-between items-start mb-4">
                        <h3 class="font-bold text-lg text-stone-900">The Sovereign Cloud</h3>
                        <span class="text-2xl">üåê</span>
                    </div>
                    <p class="text-sm text-stone-600 mb-4"><strong>Focus:</strong> Crypto, AI & Decentralized Capital.</p>
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between"><span>Mobility</span><span class="text-green-600 font-bold">Instant</span></div>
                        <div class="flex justify-between"><span>Regulation</span><span class="text-amber-600 font-bold">Resistant</span></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 5: UNCERTAINTIES & SIMULATOR -->
        <section id="risks" class="bg-stone-200 rounded-xl p-8 border border-stone-300">
             <div class="flex flex-col md:flex-row gap-8 items-start">
                <div class="md:w-1/3">
                    <h2 class="text-2xl font-bold text-stone-900 mb-4">The Fog of War: Major Uncertainties</h2>
                    <p class="text-stone-600 text-sm mb-6">
                        No model is perfect. While the trend points to devaluation, these "Black Swans" could accelerate, delay, or completely alter the trajectory.
                    </p>
                    <div class="bg-stone-800 text-stone-200 p-4 rounded text-xs font-mono">
                        > CALCULATING VOLATILITY INDEX...<br>
                        > WAR_RISK = HIGH<br>
                        > TECH_DEFLATION = UNKNOWN<br>
                        > SOCIAL_COHESION = CRITICAL
                    </div>
                </div>
                
                <div class="md:w-2/3 space-y-4">
                    <!-- Standard Risk Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <!-- Uncertainty 1 -->
                        <div class="bg-white p-4 rounded shadow-sm flex items-center gap-4">
                            <div class="bg-red-100 text-red-700 p-3 rounded font-bold text-xl">‚ö†Ô∏è</div>
                            <div>
                                <h4 class="font-bold text-stone-800">Kinetic Conflict</h4>
                                <p class="text-xs text-stone-600">Historically, multipolarity transitions involve war. Does economic rivalry turn kinetic?</p>
                            </div>
                        </div>
                        <!-- Uncertainty 2 -->
                        <div class="bg-white p-4 rounded shadow-sm flex items-center gap-4">
                            <div class="bg-blue-100 text-blue-700 p-3 rounded font-bold text-xl">ü§ñ</div>
                            <div>
                                <h4 class="font-bold text-stone-800">AI vs. Inflation</h4>
                                <p class="text-xs text-stone-600">Technology is deflationary. Could an AI boom offset the debt spiral?</p>
                            </div>
                        </div>
                    </div>

                    <!-- ‚ú® GEMINI INTEGRATION: Scenario Simulator -->
                    <div class="bg-indigo-900 rounded-lg p-5 border border-indigo-700 shadow-lg text-white">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="animate-pulse">‚ú®</span>
                            <h3 class="font-bold text-lg text-indigo-100">AI Stress Test Simulator</h3>
                        </div>
                        <p class="text-xs text-indigo-300 mb-3">
                            Type a "What If" scenario below to stress-test the thesis using Gemini AI.
                        </p>
                        <div class="flex gap-2">
                            <input type="text" id="scenarioInput" placeholder="e.g., What if the Euro collapses before the Dollar?" 
                                class="flex-1 bg-indigo-950/50 border border-indigo-700 rounded px-3 py-2 text-sm text-white placeholder-indigo-400 focus:outline-none focus:border-indigo-500 transition-colors">
                            <button onclick="runScenario()" id="scenarioBtn" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded text-sm font-medium transition-colors flex items-center gap-2">
                                <span>Simulate</span>
                            </button>
                        </div>
                        <div id="scenarioResult" class="hidden mt-4 bg-indigo-950/80 p-3 rounded border border-indigo-800 text-xs leading-relaxed text-indigo-200">
                            <!-- AI Output will appear here -->
                        </div>
                    </div>
                </div>
             </div>
        </section>

        <!-- SECTION 6: ALLOCATION -->
        <section id="allocation">
            <h2 class="text-2xl font-bold text-stone-800 mb-6">The "Real Value" Portfolio (2026‚Äì2035)</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white rounded-lg overflow-hidden shadow-sm border border-stone-200">
                    <thead class="bg-stone-50 border-b border-stone-200">
                        <tr>
                            <th class="py-3 px-6 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Asset Class</th>
                            <th class="py-3 px-6 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Strategic Role</th>
                            <th class="py-3 px-6 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">The "Why" (Research)</th>
                            <th class="py-3 px-6 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Projected Return (Historical Adj.)</th>
                            <th class="py-3 px-6 text-left text-xs font-medium text-stone-500 uppercase tracking-wider">Vehicles (Examples)</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-stone-200">
                        <tr class="hover:bg-stone-50 transition">
                            <td class="py-4 px-6 font-medium text-stone-900">Precious Metals</td>
                            <td class="py-4 px-6 text-sm text-stone-600">Monetary Anchor</td>
                            <td class="py-4 px-6 text-sm text-stone-600">Central Bank accumulation. Hedge against negative real rates.</td>
                            <td class="py-4 px-6 text-sm">
                                <span class="font-bold text-emerald-600 block">Potential 3x - 5x</span>
                                <span class="text-xs text-stone-400 italic">Ref: 1970s Gold moved ~24x</span>
                            </td>
                            <td class="py-4 px-6 text-sm text-stone-600 space-x-1"><span class="ticker-badge">PHYS</span><span class="ticker-badge">GDX</span></td>
                        </tr>
                        <tr class="hover:bg-stone-50 transition">
                            <td class="py-4 px-6 font-medium text-stone-900">Energy (Uranium/Oil)</td>
                            <td class="py-4 px-6 text-sm text-stone-600">Growth Engine</td>
                            <td class="py-4 px-6 text-sm text-stone-600">AI power bottleneck. Structural deficits in Uranium.</td>
                            <td class="py-4 px-6 text-sm">
                                <span class="font-bold text-emerald-600 block">Potential 5x - 10x</span>
                                <span class="text-xs text-stone-400 italic">Supply Crunch + Miner Leverage</span>
                            </td>
                            <td class="py-4 px-6 text-sm text-stone-600 space-x-1"><span class="ticker-badge">URNM</span><span class="ticker-badge">XLE</span></td>
                        </tr>
                        <tr class="hover:bg-stone-50 transition">
                            <td class="py-4 px-6 font-medium text-stone-900">Industrial Metals</td>
                            <td class="py-4 px-6 text-sm text-stone-600">Electrification Play</td>
                            <td class="py-4 px-6 text-sm text-stone-600">Copper supply cliff vs. Demand shock (Grid/EVs).</td>
                            <td class="py-4 px-6 text-sm">
                                <span class="font-bold text-emerald-600 block">Potential 10x+ (Multibagger)</span>
                                <span class="text-xs text-stone-400 italic">Supercycle: Shortage meets Inflation</span>
                            </td>
                            <td class="py-4 px-6 text-sm text-stone-600 space-x-1"><span class="ticker-badge">COPX</span><span class="ticker-badge">SILJ</span></td>
                        </tr>
                        <tr class="hover:bg-stone-50 transition">
                            <td class="py-4 px-6 font-medium text-stone-900">Productive Land</td>
                            <td class="py-4 px-6 text-sm text-stone-600">Inflation Yield</td>
                            <td class="py-4 px-6 text-sm text-stone-600">Food scarcity. Inflation-adjusted rents.</td>
                            <td class="py-4 px-6 text-sm">
                                <span class="font-bold text-emerald-600 block">Steady 10% - 15% CAGR</span>
                                <span class="text-xs text-stone-400 italic">Wealth Preservation</span>
                            </td>
                            <td class="py-4 px-6 text-sm text-stone-600 space-x-1"><span class="ticker-badge">LAND</span><span class="ticker-badge">MOO</span></td>
                        </tr>
                        <tr class="hover:bg-stone-50 transition">
                            <td class="py-4 px-6 font-medium text-stone-900">Digital Sovereignty</td>
                            <td class="py-4 px-6 text-sm text-stone-600">Asymmetric Hedge</td>
                            <td class="py-4 px-6 text-sm text-stone-600">"Digital Hard Money" outside banking system.</td>
                            <td class="py-4 px-6 text-sm">
                                <span class="font-bold text-emerald-600 block">Asymmetric (10x - 20x)</span>
                                <span class="text-xs text-stone-400 italic">Adoption S-Curve</span>
                            </td>
                            <td class="py-4 px-6 text-sm text-stone-600 space-x-1"><span class="ticker-badge">BTC</span><span class="ticker-badge">IBIT</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

    </main>

    <!-- ‚ú® GEMINI INTEGRATION: Chat Widget -->
    <div id="chat-container" class="fixed bottom-6 right-6 z-50 flex flex-col items-end">
        
        <!-- Chat Window -->
        <div id="chat-window" class="hidden w-80 sm:w-96 bg-white rounded-xl shadow-2xl border border-stone-200 mb-4 overflow-hidden flex flex-col h-[500px]">
            <div class="bg-stone-900 p-4 flex justify-between items-center text-white">
                <div class="flex items-center gap-2">
                    <span class="text-lg">‚ú®</span>
                    <div>
                        <h3 class="font-bold text-sm">Macro Shift Analyst</h3>
                        <p class="text-[10px] text-stone-400">Powered by Gemini AI</p>
                    </div>
                </div>
                <button onclick="toggleChat()" class="text-stone-400 hover:text-white">‚úï</button>
            </div>
            
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-3 bg-stone-50 text-sm">
                <!-- Welcome Message -->
                <div class="flex gap-2">
                    <div class="w-6 h-6 rounded-full bg-stone-900 text-white flex items-center justify-center text-xs flex-shrink-0">AI</div>
                    <div class="bg-white p-3 rounded-tr-lg rounded-br-lg rounded-bl-lg border border-stone-200 shadow-sm text-stone-700">
                        Hello! I am trained on the "Macro Shift" thesis. Ask me about the debt cycle, hard assets, or the 2026 outlook.
                    </div>
                </div>
            </div>

            <div class="p-3 bg-white border-t border-stone-200">
                <div class="flex gap-2">
                    <input type="text" id="chatInput" placeholder="Ask a question..." class="flex-1 bg-stone-100 border border-stone-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-amber-500 focus:bg-white transition-all">
                    <button onclick="sendChatMessage()" id="chatSendBtn" class="bg-stone-900 hover:bg-stone-800 text-white rounded-lg px-3 transition-colors">‚û§</button>
                </div>
            </div>
        </div>

        <!-- Floating Action Button -->
        <button onclick="toggleChat()" class="group flex items-center justify-center w-14 h-14 bg-stone-900 text-white rounded-full shadow-lg hover:bg-amber-600 transition-all duration-300 hover:scale-110 focus:outline-none ring-2 ring-stone-900 ring-offset-2">
            <span class="text-2xl group-hover:hidden">üí¨</span>
            <span class="text-2xl hidden group-hover:block">‚ú®</span>
        </button>
    </div>

    <footer class="bg-stone-900 border-t border-stone-800 text-stone-500 py-12 text-center">
        <p class="text-sm">Analysis based on "Deep Research Report: The Great Rotation (2026-2035)".</p>
        <p class="text-xs mt-2 max-w-2xl mx-auto">Disclaimer: This dashboard is a visualization of research data. It does not constitute financial advice. Tickers are for illustrative purposes only.</p>
    </footer>

    <script>
        // --- CHART JS SETUP ---
        const ctxFiscal = document.getElementById('fiscalChart').getContext('2d');
        const fiscalChart = new Chart(ctxFiscal, {
            type: 'line',
            data: {
                labels: ['2020', '2021', '2022', '2023', '2024', '2025 (Est)', '2026 (Proj)'],
                datasets: [
                    {
                        label: 'Defense Spending ($B)',
                        data: [714, 742, 765, 816, 841, 886, 900],
                        borderColor: '#78716c',
                        borderWidth: 2,
                        tension: 0.4
                    },
                    {
                        label: 'Interest on Debt ($B)',
                        data: [345, 352, 475, 659, 870, 1050, 1200],
                        borderColor: '#dc2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        fill: true,
                        borderWidth: 3,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    y: {
                        grid: { color: '#e7e5e4' },
                        title: { display: true, text: 'Billions USD' }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });

        // --- GEMINI API INTEGRATION ---
        
        const apiKey = ""; // Provided by runtime environment
        
        // System Prompt: Defines the AI's persona and knowledge base
        const systemContext = `
            You are an expert Macro Analyst specializing in the "150-Year Cycle Shift" thesis. 
            CORE THESIS:
            1. The US Debt cycle is ending; interest payments > defense spending.
            2. The Petrodollar system is diluting due to BRICS+ and oil settling in multiple currencies (starting ~2026).
            3. We are rotating from Financial Assets (Stocks/Bonds) to Hard Assets (Gold, Commodities, Land).
            4. Future power is multipolar: China (Manufacturing), India (Demographics), Resource Bloc (BRICS), and Digital Sovereign (Crypto).
            
            YOUR TONE: Professional, objective, data-driven, but firm on the "Shift" thesis. 
            Avoid generic financial advice disclaimers in every sentence, but imply risk.
            Keep answers concise (under 100 words) unless asked for details.
            Use Markdown for formatting.
        `;

        // Helper Function to Call Gemini
        async function callGeminiAPI(userPrompt) {
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userPrompt }] }],
                            systemInstruction: { parts: [{ text: systemContext }] }
                        })
                    }
                );
                
                if (!response.ok) throw new Error('API Error');
                
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini Error:", error);
                return "I apologize, but I'm having trouble analyzing the data stream right now. Please try again.";
            }
        }

        // --- FEATURE 1: SCENARIO SIMULATOR ---
        
        async function runScenario() {
            const input = document.getElementById('scenarioInput');
            const resultDiv = document.getElementById('scenarioResult');
            const btn = document.getElementById('scenarioBtn');
            const userScenario = input.value.trim();

            if (!userScenario) return;

            // UI Loading State
            btn.innerHTML = `<span class="animate-spin">‚Üª</span> Analyzing...`;
            btn.disabled = true;
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = `<span class="animate-pulse">Consulting the model...</span>`;

            // Prompt Engineering for specific scenario
            const prompt = `
                Analyze the following "What If" scenario specifically through the lens of the "150-Year Cycle Shift" thesis:
                SCENARIO: "${userScenario}"
                
                Output structure:
                1. **Impact on USD:** (Strengthen or Weaken?)
                2. **Impact on Hard Assets:** (Gold/Oil/Land reaction?)
                3. **Cycle Conclusion:** (Does this accelerate or delay the cycle shift?)
                Keep it brief and punchy.
            `;

            const aiResponse = await callGeminiAPI(prompt);

            // Render Markdown using marked.js
            resultDiv.innerHTML = marked.parse(aiResponse);
            
            // Reset UI
            btn.innerHTML = `<span>Simulate</span>`;
            btn.disabled = false;
        }

        // --- FEATURE 2: IMPACT CHAIN LOGIC ---
        const chains = {
            'dedollar': {
                title: "Petrodollar Dilution",
                desc: "Oil trade shifting from USD exclusivity to a multi-currency basket (Yuan, Gold, Local), reducing structural global demand for Dollars.",
                timeRange: "2026-2030",
                triggers: ["Saudi Arabia accepts Yuan for Oil", "BRICS Pay system launch", "US Sanctions accelerate non-SWIFT trade"],
                commodities: ["Gold (Monetary Premium)", "Oil (Pricing Fragmented)"],
                sectors: ["Global Banking (SWIFT Volume)", "Sovereign Debt Markets"],
                winners: "BRICS Nations, Gold Holders, Hard Asset Exporters",
                losers: "US Treasury Market (Yields Up), USD Importers"
            },
            'ai_energy': {
                title: "AI & Energy Crunch",
                desc: "AI Data centers require 3x-10x more power. The grid is old. This forces a massive capital cycle into baseload power generation.",
                timeRange: "2025-2028",
                triggers: ["Hyperscalers buy Nuclear Plants", "Rolling Brownouts in Tech Hubs", "Copper Inventory collapse"],
                commodities: ["Copper (Grid)", "Uranium (Nuclear)", "Natural Gas"],
                sectors: ["Utilities (Repricing)", "Industrial Mining", "Tech Hyperscalers"],
                winners: "Nuclear Energy Producers, Grid Infrastructure Firms, Commodity Rich Nations",
                losers: "Energy-Poor Tech Hubs, Legacy Consumers (Higher Prices)"
            },
            'war_eco': {
                title: "The War Economy",
                desc: "Geopolitical friction leads to on-shoring and re-militarization. Governments prioritize security of supply over efficiency/price.",
                timeRange: "Immediate - 2030",
                triggers: ["Supply Chain Blockades", "Export Controls on Rare Earths", "Defense Spending > 5% GDP"],
                commodities: ["Strategic Metals", "Oil (Strategic Reserves)", "Food"],
                sectors: ["Defense Contractors", "Domestic Manufacturing", "Cybersecurity"],
                winners: "Defense Stocks, Domestic Logistics, Protected Industries",
                losers: "Globalized Supply Chains, Just-In-Time Manufacturing"
            },
            'hard_money': {
                title: "Sound Money Return",
                desc: "Fiscal dominance forces central banks to print. Investors flee 'Paper' promises for assets with no counterparty risk.",
                timeRange: "2027-2035",
                triggers: ["Yield Curve Control Implementation", "Sovereign Debt Restructuring", "CBDC vs. Crypto Regulation"],
                commodities: ["Gold", "Silver", "Bitcoin (Digital Hard Asset)"],
                sectors: ["Precious Metal Miners", "Digital Asset Infrastructure"],
                winners: "Asset Owners, Debtors (Inflating away debt)",
                losers: "Cash Savers, Fixed Income Pensioners, Bond Holders"
            }
        };

        let currentChain = 'dedollar';

        function renderChain(key) {
            currentChain = key;
            const data = chains[key];

            // 1. Update Buttons
            document.querySelectorAll('.chain-tab').forEach(btn => {
                btn.classList.remove('bg-amber-600', 'text-white', 'border-amber-600');
                btn.classList.add('bg-white', 'text-stone-600', 'border-stone-300');
                if (btn.getAttribute('onclick').includes(key)) {
                    btn.classList.remove('bg-white', 'text-stone-600', 'border-stone-300');
                    btn.classList.add('bg-amber-600', 'text-white', 'border-amber-600');
                }
            });

            // 2. Update Content with simple animation
            const content = document.getElementById('chainContent');
            content.style.opacity = '0.5';
            
            setTimeout(() => {
                document.getElementById('chain-title').innerText = data.title;
                document.getElementById('chain-desc').innerText = data.desc;
                
                // NEW: Time Range & Triggers
                document.getElementById('chain-timerange').innerText = data.timeRange;
                document.getElementById('chain-triggers').innerHTML = data.triggers.map(t => `<li>${t}</li>`).join('');

                // Commodities Badges
                const commContainer = document.getElementById('chain-commodities');
                commContainer.innerHTML = data.commodities.map(c => 
                    `<span class="px-2 py-1 bg-stone-100 text-stone-700 text-xs rounded border border-stone-200 font-mono">${c}</span>`
                ).join('');

                // Sectors List
                const secContainer = document.getElementById('chain-sectors');
                secContainer.innerHTML = data.sectors.map(s => `<li>${s}</li>`).join('');

                document.getElementById('chain-winners').innerText = data.winners;
                document.getElementById('chain-losers').innerText = data.losers;

                content.style.opacity = '1';
            }, 150);
        }

        async function analyzeChain() {
            const chatWin = document.getElementById('chat-window');
            if (chatWin.classList.contains('hidden')) toggleChat();

            const data = chains[currentChain];
            const prompt = `Deep dive into this specific macro chain:
            Theme: ${data.title}
            Description: ${data.desc}
            Time Range: ${data.timeRange}
            Triggers: ${data.triggers.join(', ')}
            Impacts: ${data.sectors.join(', ')} and ${data.commodities.join(', ')}.
            
            Explain the investment logic: Why specifically does this theme lead to these winners/losers? 
            What is the "Second Order Effect" people might miss?`;

            addMessage(`Analyzing the chain: **${data.title}**...`, 'ai', true); 
            const response = await callGeminiAPI(prompt);
            
            const messagesDiv = document.getElementById('chat-messages');
            const lastMsg = messagesDiv.lastElementChild;
            if(lastMsg) {
                 const contentDiv = lastMsg.querySelector('.prose');
                 contentDiv.classList.remove('animate-pulse');
                 contentDiv.innerHTML = marked.parse(response);
            }
        }

        // --- FEATURE 3: CHAT WIDGET LOGIC ---

        const chatWindow = document.getElementById('chatWindow');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');

        function toggleChat() {
            const win = document.getElementById('chat-window');
            if (win.classList.contains('hidden')) {
                win.classList.remove('hidden');
                win.classList.add('chat-slide-in');
                win.classList.remove('chat-slide-out');
            } else {
                win.classList.remove('chat-slide-in');
                win.classList.add('chat-slide-out');
                setTimeout(() => win.classList.add('hidden'), 280);
            }
        }

        async function sendChatMessage() {
            const text = document.getElementById('chatInput').value.trim();
            if (!text) return;

            // 1. Add User Message
            addMessage(text, 'user');
            document.getElementById('chatInput').value = '';

            // 2. Add Loading Message
            const loadingId = addMessage('Analyzing...', 'ai', true);

            // 3. Call API
            const response = await callGeminiAPI(text);

            // 4. Update AI Message
            updateMessage(loadingId, response);
        }

        function addMessage(text, sender, isLoading = false) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `flex gap-2 ${sender === 'user' ? 'flex-row-reverse' : ''}`;
            const id = 'msg-' + Date.now();
            msgDiv.id = id;

            const avatar = sender === 'user' 
                ? `<div class="w-6 h-6 rounded-full bg-stone-300 text-stone-600 flex items-center justify-center text-xs flex-shrink-0">You</div>`
                : `<div class="w-6 h-6 rounded-full bg-stone-900 text-white flex items-center justify-center text-xs flex-shrink-0">AI</div>`;

            const bubbleClass = sender === 'user'
                ? `bg-stone-800 text-white rounded-tl-lg rounded-bl-lg rounded-br-lg`
                : `bg-white text-stone-700 rounded-tr-lg rounded-br-lg rounded-bl-lg border border-stone-200 shadow-sm`;

            msgDiv.innerHTML = `
                ${avatar}
                <div class="${bubbleClass} p-3 max-w-[85%] prose prose-sm ${isLoading ? 'animate-pulse' : ''}">
                    ${isLoading ? text : marked.parse(text)}
                </div>
            `;

            document.getElementById('chat-messages').appendChild(msgDiv);
            document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
            return id;
        }

        function updateMessage(id, newText) {
            const el = document.getElementById(id);
            if (el) {
                const contentDiv = el.querySelector('.prose');
                contentDiv.classList.remove('animate-pulse');
                contentDiv.innerHTML = marked.parse(newText);
            }
        }

        // Allow Enter key to send
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendChatMessage();
        });
        document.getElementById('scenarioInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') runScenario();
        });

    </script>
</body>
</html>